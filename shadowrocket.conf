# Source: https://github.com/gragragrab/shadowrocket-conf
# Updated: Aug 26 17:11:43 +04 2025
# Integrated with shadowrocket-configuration-file rules https://github.com/misha-tgshv/shadowrocket-configuration-file

[General]
# Needed to bypass problems with push notifications
bypass-system = true

# IPv6
ipv6 = false
# Priority for IPv6 DNS servers and AAAA records
prefer-ipv6 = false

private-ip-answer = true

# DNS resovle using system DNS
dns-direct-system = false
dns-fallback-system = false

# direct domain fail to resolve use proxy rule
dns-direct-fallback-proxy = true

# Enhanced DNS configuration from shadowrocket-configuration-file
# Using DNS-over-HTTPS for privacy and bypassing filters
dns-server = https://dns.google/dns-query, https://dns.adguard-dns.com/dns-query
fallback-dns-server = system

# DNS highjack. Some devices or software always use hard-coded DNS servers, for example Netflix sends requests through Google DNS.
# You can use this option to intercept requests.
hijack-dns = :53

# Skip proxy. This option makes the connection ranges for these domain names or IP addresses
# be handled by the Shadowrocket TUN interface, not the Shadowrocket proxy server.
# This option is used to solve some compatibility problems with some applications.
# Includes Tailscale network range (100.64.0.0/10) for compatibility
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,100.64.0.0/10,localhost,*.local,captive.apple.com


# Route bypass TUN. The Shadowrocket TUN interface only supports the TCP protocol.
# Use this option to bypass the specified IP address range, allowing other protocols to pass through it.
# Includes Tailscale network range (100.64.0.0/10) for compatibility - this ensures Tailscale traffic bypasses Shadowrocket completely
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32, 239.255.255.250/32


# Always use the real IP address, this option requires Shadowrocket to handle DNS queries in TUN
# and return the real IP address instead of the fake IP address.
always-real-ip=time.*.com,ntp.*.com,*.cloudflareclient.com,*.apple.com

# Support for ICMP protocol auto-reply (set to false to save battery)
icmp-auto-reply = false

# If the REJECT policy is not enabled, by default it will only take effect in the configuration mode.
# After enabling the policy, the policy may become effective in other global routing modes.
always-reject-url-rewrite = false

# The fallback behavior when UDP traffic matches a policy that doesn't support the UDP relay. Possible values: DIRECT, REJECT.
udp-policy-not-supported-behaviour = REJECT

# URL for updating the configuration file
update-url = https://raw.githubusercontent.com/gragragrab/shadowrocket-conf/main/shadowrocket.conf

[Proxy Group]
AUTO = url-test,interval=600,timeout=5,url=https://cp.cloudflare.com/generate_204,policy-regex-filter=*

[Rule]
# 1. DIRECT SERVICES (must not be proxied)
# Banking domains
RULE-SET,https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/rules/domains_banking.list,DIRECT

# 2. GEO-BASED RULES (fast with MaxMind)
# Russian traffic - direct (ensures Russian services always work)
GEOIP,RU,DIRECT

# 3. KNOWN BLOCKED SERVICES (what actually needs proxy)
# YouTube domains
RULE-SET,https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/rules/domains_youtube.list,PROXY

# Discord domains and ports
RULE-SET,https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/rules/domains_discord.list,PROXY
RULE-SET,https://raw.githubusercontent.com/helmiau/clashrules/refs/heads/main/shadowrocket/Game_Discord_Ports.list,PROXY

# WhatsApp IP addresses
RULE-SET,https://raw.githubusercontent.com/HybridNetworks/whatsapp-cidr/refs/heads/main/WhatsApp/whatsapp_cidr_ipv4.list,PROXY,no-resolve

# Telegram
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Telegram/Telegram.list,PROXY

# Re:filter lists (curated Russian block list)
RULE-SET,https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/rules/domains_refilter.list,PROXY
RULE-SET,https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/rules/ips_refilter.list,PROXY,no-resolve

# Community domains (Telegram chat "Pro Shadowrocket на русском")
RULE-SET,https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/rules/domains_community.list,PROXY

# ============================================
# CUSTOM RULES (add your own rules here)
# ============================================

# Example custom domain rules:
# DOMAIN-SUFFIX,example.com,PROXY
# DOMAIN-KEYWORD,blocked-keyword,PROXY

# Example custom IP rules:
# IP-CIDR,192.168.100.0/24,DIRECT
# IP-CIDR6,2001:db8::/32,PROXY

# ============================================
# FINAL RULE
# ============================================
FINAL,DIRECT

[Host]
localhost = 127.0.0.1

[URL Rewrite]
^http://(www.)?yandex.ru https://www.ya.ru 302
^https?://(www.)?google.ru https://www.google.com 302
